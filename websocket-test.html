<!DOCTYPE html>
<html>
<head>
    <title>WebSocket Connection Test</title>
</head>
<body>
    <h2>üß™ Testing WebSocket Connection to HiveMQ</h2>
    <div id="log"></div>
    
    <script>
        const log = (message) => {
            const div = document.getElementById('log');
            div.innerHTML += `[${new Date().toLocaleTimeString()}] ${message}<br>`;
            console.log(message);
        };
        
        log('üöÄ Starting WebSocket test...');
        
        // Test raw WebSocket connection (without MQTT)
        const wsUrl = 'wss://16d97e84c4364ffa9d0e5a0f0fa09165.s1.eu.hivemq.cloud:8884/mqtt';
        log(`üì° Connecting to: ${wsUrl}`);
        
        const ws = new WebSocket(wsUrl);
        
        ws.onopen = (event) => {
            log('‚úÖ WebSocket connection opened!');
            log('üìã Connection details: ' + JSON.stringify(event));
            
            // Close after success
            setTimeout(() => {
                ws.close();
                log('üîå WebSocket closed after successful test');
            }, 2000);
        };
        
        ws.onerror = (error) => {
            log('‚ùå WebSocket error: ' + JSON.stringify(error));
            log('üîß Error details: ' + error.toString());
        };
        
        ws.onclose = (event) => {
            log(`üîå WebSocket closed: code=${event.code}, reason="${event.reason}", clean=${event.wasClean}`);
            
            if (event.code === 1006) {
                log('‚ö†Ô∏è Connection closed abnormally - possible network/firewall issue');
            } else if (event.code === 1002) {
                log('‚ö†Ô∏è Protocol error - possible authentication issue');
            }
        };
        
        ws.onmessage = (message) => {
            log('üì® Received message: ' + message.data);
        };
        
        // Timeout test
        setTimeout(() => {
            if (ws.readyState === WebSocket.CONNECTING) {
                log('‚è∞ Connection timeout - closing...');
                ws.close();
            }
        }, 10000);
    </script>
</body>
</html>